TSConfig={APP_URL:"http://app.topspin.net/",SSL_APP_URL:"https://app.topspin.net/",STORE_URL:"https://store.topspin.net/",FLASH_URL:"http://app.topspin.net/flash/",IMAGE_URL:"http://app.topspin.net/images/",CDN_URL:"http://cdn.topspin.net/",BEACON_URL:"http://px.topspin.net/ev?env=production"};if("https:"==document.location.protocol){TSConfig.APP_URL=TSConfig.SSL_APP_URL}TSCoreUtil={DOM:{addEventHandler:function(b,a,c){if(typeof b.addEventListener!="undefined"){b.addEventListener(a,c,false)}else{if(typeof b.attachEvent!="undefined"){b.attachEvent("on"+a,c)}}},removeEventHandler:function(b,a,c){if(typeof b.removeEventListener!="undefined"){b.removeEventListener(a,c,false)}else{if(typeof b.detachEvent!="undefined"){b.detachEvent("on"+a,c)}}}},Event:{preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},stopPropagation:function(a){a=(a)?a:event;if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}}},createStyleSheet:function(e,b){var a=document.createElement("link");a.media="screen";a.rel="stylesheet";a.type="text/css";a.id=e;a.href=b;var d=document.getElementsByTagName("head")[0];var c=d.firstChild;d.insertBefore(a,c)},getQueryParams:function(b){b=b||document.location.href;b=b.replace(/^\s+/,"").replace(/\s+$/,"");var a=b.match(/([^?#]*)(#.*)?$/);if(!a){return{}}var h={};var f=a[1].split("&");for(var d=0;d<f.length;d++){var g=f[d].split("=");if(g[0]){var c=decodeURIComponent(g[0]);var e=g[1];if(e){e=decodeURIComponent(e)}if(c in h){if(!(h[c] instanceof Array)){h[c]=[h[c]]}h[c].push(e)}else{h[c]=e}}}return h}};TSTrackingEvent=(function(){var d=null;function a(){if(!d){d=document.createElement("img");d.className="invisible_image"}return d.cloneNode(false)}function b(f){var e=a();e.src=c(f);document.body.appendChild(e);return true}function c(f){f=f||{};f.u=f.u||TSConfig.parentLocation||document.location.href;f.c=f.c||f.cId;f.et=f.et||0;var e=TSConfig.BEACON_URL+"&et="+f.et+"&c="+f.c+"&u="+encodeURIComponent(f.u)+"&timestamp="+new Date().getTime();if(f.st||f.st===0){e+="&st="+f.st}if(f.m){e+="&m="+f.m}if(f.ru){e+="&ru="+encodeURIComponent(f.ru)}return e}return{logEvent:b,getEventUrl:c}})();if(!window.TSswfobject){var TSswfobject=function(){var aq="undefined",aD="object",ab="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",aE="application/x-shockwave-flash",ac="SWFObjectExprInst",ax="onreadystatechange",af=window,aL=document,aB=navigator,aa=false,Z=[aN],aG=[],ag=[],al=[],aJ,ad,ap,at,ak=false,aU=false,aH,an,aI=true,ah=function(){var a=typeof aL.getElementById!=aq&&typeof aL.getElementsByTagName!=aq&&typeof aL.createElement!=aq,e=aB.userAgent.toLowerCase(),c=aB.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(e),k=c?/mac/.test(c):/mac/.test(e),g=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,d=!+"\v1",f=[0,0,0],l=null;if(typeof aB.plugins!=aq&&typeof aB.plugins[ab]==aD){l=aB.plugins[ab].description;if(l&&!(typeof aB.mimeTypes!=aq&&aB.mimeTypes[aE]&&!aB.mimeTypes[aE].enabledPlugin)){aa=true;d=false;l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1");f[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10);f[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10);f[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof af.ActiveXObject!=aq){try{var j=new ActiveXObject(X);if(j){l=j.GetVariable("$version");if(l){d=true;l=l.split(" ")[1].split(",");f=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]}}}catch(b){}}}return{w3:a,pv:f,wk:g,ie:d,win:h,mac:k}}(),aK=function(){if(!ah.w3){return}if((typeof aL.readyState!=aq&&aL.readyState=="complete")||(typeof aL.readyState==aq&&(aL.getElementsByTagName("body")[0]||aL.body))){aP()}if(!ak){if(typeof aL.addEventListener!=aq){aL.addEventListener("DOMContentLoaded",aP,false)}if(ah.ie&&ah.win){aL.attachEvent(ax,function(){if(aL.readyState=="complete"){aL.detachEvent(ax,arguments.callee);aP()}});if(af==top){(function(){if(ak){return}try{aL.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}aP()})()}}if(ah.wk){(function(){if(ak){return}if(!/loaded|complete/.test(aL.readyState)){setTimeout(arguments.callee,0);return}aP()})()}aC(aP)}}();function aP(){if(ak){return}try{var b=aL.getElementsByTagName("body")[0].appendChild(ar("span"));b.parentNode.removeChild(b)}catch(a){return}ak=true;var d=Z.length;for(var c=0;c<d;c++){Z[c]()}}function aj(a){if(ak){a()}else{Z[Z.length]=a}}function aC(a){if(typeof af.addEventListener!=aq){af.addEventListener("load",a,false)}else{if(typeof aL.addEventListener!=aq){aL.addEventListener("load",a,false)}else{if(typeof af.attachEvent!=aq){aM(af,"onload",a)}else{if(typeof af.onload=="function"){var b=af.onload;af.onload=function(){b();a()}}else{af.onload=a}}}}}function aN(){if(aa){Y()}else{am()}}function Y(){var d=aL.getElementsByTagName("body")[0];var b=ar(aD);b.setAttribute("type",aE);var a=d.appendChild(b);if(a){var c=0;(function(){if(typeof a.GetVariable!=aq){var e=a.GetVariable("$version");if(e){e=e.split(" ")[1].split(",");ah.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]}}else{if(c<10){c++;setTimeout(arguments.callee,10);return}}d.removeChild(b);a=null;am()})()}else{am()}}function am(){var g=aG.length;if(g>0){for(var h=0;h<g;h++){var c=aG[h].id;var m=aG[h].callbackFn;var a={success:false,id:c};if(ah.pv[0]>0){var j=aS(c);if(j){if(ao(aG[h].swfVersion)&&!(ah.wk&&ah.wk<312)){ay(c,true);if(m){a.success=true;a.ref=av(c);m(a)}}else{if(aG[h].expressInstall&&au()){var e={};e.data=aG[h].expressInstall;e.width=j.getAttribute("width")||"0";e.height=j.getAttribute("height")||"0";if(j.getAttribute("class")){e.styleclass=j.getAttribute("class")}if(j.getAttribute("align")){e.align=j.getAttribute("align")}var f={};var d=j.getElementsByTagName("param");var l=d.length;for(var k=0;k<l;k++){if(d[k].getAttribute("name").toLowerCase()!="movie"){f[d[k].getAttribute("name")]=d[k].getAttribute("value")}}ae(e,f,c,m)}else{aF(j);if(m){m(a)}}}}}else{ay(c,true);if(m){var b=av(c);if(b&&typeof b.SetVariable!=aq){a.success=true;a.ref=b}m(a)}}}}}function av(b){var d=null;var c=aS(b);if(c&&c.nodeName=="OBJECT"){if(typeof c.SetVariable!=aq){d=c}else{var a=c.getElementsByTagName(aD)[0];if(a){d=a}}}return d}function au(){return !aU&&ao("6.0.65")&&(ah.win||ah.mac)&&!(ah.wk&&ah.wk<312)}function ae(f,d,h,e){aU=true;ap=e||null;at={success:false,id:h};var a=aS(h);if(a){if(a.nodeName=="OBJECT"){aJ=aO(a);ad=null}else{aJ=a;ad=h}f.id=ac;if(typeof f.width==aq||(!/%$/.test(f.width)&&parseInt(f.width,10)<310)){f.width="310"}if(typeof f.height==aq||(!/%$/.test(f.height)&&parseInt(f.height,10)<137)){f.height="137"}aL.title=aL.title.slice(0,47)+" - Flash Player Installation";var b=ah.ie&&ah.win?"ActiveX":"PlugIn",c="MMredirectURL="+af.location.toString().replace(/&/g,"%26")+"&MMplayerType="+b+"&MMdoctitle="+aL.title;if(typeof d.flashvars!=aq){d.flashvars+="&"+c}else{d.flashvars=c}if(ah.ie&&ah.win&&a.readyState!=4){var g=ar("div");h+="SWFObjectNew";g.setAttribute("id",h);a.parentNode.insertBefore(g,a);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}aA(f,d,h)}}function aF(a){if(ah.ie&&ah.win&&a.readyState!=4){var b=ar("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(aO(a),b);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(aO(a),a)}}function aO(b){var d=ar("div");if(ah.win&&ah.ie){d.innerHTML=b.innerHTML}else{var e=b.getElementsByTagName(aD)[0];if(e){var a=e.childNodes;if(a){var f=a.length;for(var c=0;c<f;c++){if(!(a[c].nodeType==1&&a[c].nodeName=="PARAM")&&!(a[c].nodeType==8)){d.appendChild(a[c].cloneNode(true))}}}}}return d}function aA(e,g,c){var d,a=aS(c);if(ah.wk&&ah.wk<312){return d}if(a){if(typeof e.id==aq){e.id=c}if(ah.ie&&ah.win){var f="";for(var j in e){if(e[j]!=Object.prototype[j]){if(j.toLowerCase()=="data"){g.movie=e[j]}else{if(j.toLowerCase()=="styleclass"){f+=' class="'+e[j]+'"'}else{if(j.toLowerCase()!="classid"){f+=" "+j+'="'+e[j]+'"'}}}}}var h="";for(var k in g){if(g[k]!=Object.prototype[k]){h+='<param name="'+k+'" value="'+g[k]+'" />'}}a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>";ag[ag.length]=e.id;d=aS(e.id)}else{var b=ar(aD);b.setAttribute("type",aE);for(var l in e){if(e[l]!=Object.prototype[l]){if(l.toLowerCase()=="styleclass"){b.setAttribute("class",e[l])}else{if(l.toLowerCase()!="classid"){b.setAttribute(l,e[l])}}}}for(var m in g){if(g[m]!=Object.prototype[m]&&m.toLowerCase()!="movie"){aQ(b,m,g[m])}}a.parentNode.replaceChild(b,a);d=b}}return d}function aQ(b,d,c){var a=ar("param");a.setAttribute("name",d);a.setAttribute("value",c);b.appendChild(a)}function aw(a){var b=aS(a);if(b&&b.nodeName=="OBJECT"){if(ah.ie&&ah.win){b.style.display="none";(function(){if(b.readyState==4){aT(a)}else{setTimeout(arguments.callee,10)}})()}else{b.parentNode.removeChild(b)}}}function aT(a){var b=aS(a);if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null}}b.parentNode.removeChild(b)}}function aS(a){var c=null;try{c=aL.getElementById(a)}catch(b){}return c}function ar(a){return aL.createElement(a)}function aM(a,c,b){a.attachEvent(c,b);al[al.length]=[a,c,b]}function ao(a){var b=ah.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return(b[0]>c[0]||(b[0]==c[0]&&b[1]>c[1])||(b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]))?true:false}function az(b,f,a,c){if(ah.ie&&ah.mac){return}var e=aL.getElementsByTagName("head")[0];if(!e){return}var g=(a&&typeof a=="string")?a:"screen";if(c){aH=null;an=null}if(!aH||an!=g){var d=ar("style");d.setAttribute("type","text/css");d.setAttribute("media",g);aH=e.appendChild(d);if(ah.ie&&ah.win&&typeof aL.styleSheets!=aq&&aL.styleSheets.length>0){aH=aL.styleSheets[aL.styleSheets.length-1]}an=g}if(ah.ie&&ah.win){if(aH&&typeof aH.addRule==aD){aH.addRule(b,f)}}else{if(aH&&typeof aL.createTextNode!=aq){aH.appendChild(aL.createTextNode(b+" {"+f+"}"))}}}function ay(a,c){if(!aI){return}var b=c?"visible":"hidden";if(ak&&aS(a)){aS(a).style.visibility=b}else{az("#"+a,"visibility:"+b)}}function ai(b){var a=/[\\\"<>\.;]/;var c=a.exec(b)!=null;return c&&typeof encodeURIComponent!=aq?encodeURIComponent(b):b}var aR=function(){if(ah.ie&&ah.win){window.attachEvent("onunload",function(){var a=al.length;for(var b=0;b<a;b++){al[b][0].detachEvent(al[b][1],al[b][2])}var d=ag.length;for(var c=0;c<d;c++){aw(ag[c])}for(var e in ah){ah[e]=null}ah=null;for(var f in TSswfobject){TSswfobject[f]=null}TSswfobject=null})}}();return{registerObject:function(a,e,c,b){if(ah.w3&&a&&e){var d={};d.id=a;d.swfVersion=e;d.expressInstall=c;d.callbackFn=b;aG[aG.length]=d;ay(a,false)}else{if(b){b({success:false,id:a})}}},getObjectById:function(a){if(ah.w3){return av(a)}},embedSWF:function(l,e,h,f,c,a,b,j,g,k){var d={success:false,id:e};if(ah.w3&&!(ah.wk&&ah.wk<312)&&l&&e&&h&&f&&c){ay(e,false);aj(function(){h+="";f+="";var r={};if(g&&typeof g===aD){for(var p in g){r[p]=g[p]}}r.data=l;r.width=h;r.height=f;var o={};if(j&&typeof j===aD){for(var q in j){o[q]=j[q]}}if(b&&typeof b===aD){for(var m in b){if(typeof o.flashvars!=aq){o.flashvars+="&"+m+"="+b[m]}else{o.flashvars=m+"="+b[m]}}}if(ao(c)){var n=aA(r,o,e);if(r.id==e){ay(e,true)}d.success=true;d.ref=n}else{if(a&&au()){r.data=a;ae(r,o,e,k);return}else{ay(e,true)}}if(k){k(d)}})}else{if(k){k(d)}}},switchOffAutoHideShow:function(){aI=false},ua:ah,getFlashPlayerVersion:function(){return{major:ah.pv[0],minor:ah.pv[1],release:ah.pv[2]}},hasFlashPlayerVersion:ao,createSWF:function(a,b,c){if(ah.w3){return aA(a,b,c)}else{return undefined}},showExpressInstall:function(b,a,d,c){if(ah.w3&&au()){ae(b,a,d,c)}},removeSWF:function(a){if(ah.w3){aw(a)}},createCSS:function(b,a,c,d){if(ah.w3){az(b,a,c,d)}},addDomLoadEvent:aj,addLoadEvent:aC,getQueryParamValue:function(b){var a=aL.location.search||aL.location.hash;if(a){if(/\?/.test(a)){a=a.split("?")[1]}if(b==null){return ai(a)}var c=a.split("&");for(var d=0;d<c.length;d++){if(c[d].substring(0,c[d].indexOf("="))==b){return ai(c[d].substring((c[d].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(aU){var a=aS(ac);if(a&&aJ){a.parentNode.replaceChild(aJ,a);if(ad){ay(ad,true);if(ah.ie&&ah.win){aJ.style.display="block"}}if(ap){ap(at)}}aU=false}}}}()}TSFlash={embed:function(c,a,b){if(!b){return}if(typeof(b.params)=="undefined"){b.params={quality:"high",wmode:TSFlash.isLinux()?"":"transparent",allowscriptaccess:"always",menu:false}}TSswfobject.embedSWF(c,a,b.width,b.height,TSFlash.minVersion[b.facing],null,b.variables,b.params)},redimensionMovie:function(d,a,b){var c=document.getElementById(d);a=parseInt(a)+23;c.style.height=a+"px";c.parentNode.style.height=a+"px"},checkMinVersion:function(c){if(typeof(c)=="undefined"){c="fan"}var b=TSswfobject.getFlashPlayerVersion();var a=TSFlash.minVersion[c].split(".");var d=false;if(parseInt(b.major)>parseInt(a[0])){d=true}else{if(parseInt(b.minor)>parseInt(a[1])&&parseInt(b.major)==parseInt(a[0])){d=true}else{if(parseInt(b.release)>=parseInt(a[2])&&parseInt(b.minor)==parseInt(a[1])){d=true}}}return d},minVersion:{artist:"9.0.115",fan:"9.0.115"},isLinux:function(){var a=/Linux/;return(a.exec(navigator.platform))},PlayerHooks:{transact:function(JSONData){var jsonObj=eval("("+JSONData+")");(!jsonObj.jsIdentifier)?ts_load_purch_flow(jsonObj.purchases,jsonObj.transactionMode):ts_load_purch_flow(jsonObj.purchases,jsonObj.transactionMode,jsonObj.jsIdentifier)}}};if(!window.TSPF){var TSPF={};TSPF.queryParams=(function(d){if(d==""){return{}}var c={};for(var e=0;e<d.length;++e){var f=d[e].split("=");if(f.length!=2){continue}c[f[0]]=decodeURIComponent(f[1].replace(/\+/g," "))}return c})(window.location.search.substr(1).split("&"));TSPF.Config={theme:"",highlightColor:"",customStylesheetURL:"",keepShoppingLink:true};TSPF.BuyButton=function(){function isTSURL(url){return url&&(url.indexOf(TSConfig.CDN_URL)===0||url.indexOf(TSConfig.STORE_URL)===0)}function sendMessageToChildFrames(messageData){var childFrames=document.getElementsByTagName("iframe");for(var i=0;i<childFrames.length;i++){var frame=childFrames[i];if(isTSURL(frame.src)){TSMessenger.send(messageData,frame.contentWindow,frame.src)}}}function createParentReceiver(){TSMessenger.addReceiver(function(e,jsonData){if(!jsonData){return}switch(jsonData.ts_action){case"LOAD_PURCHASE_FLOW":TSPF.BuyButton.loadPurchaseFlow(jsonData.pf_params);break;case"CHECK_PARENT_RECEIVER":sendMessageToChildFrames({ts_event_type:"PARENT_RECEIVER_READY"});break;default:}},TSConfig.CDN_URL.replace(/\/$/,""),"openPFReceiver");sendMessageToChildFrames({ts_event_type:"PARENT_RECEIVER_READY"})}function checkForParentReceiver(){if(!TSConfig.parentLocation){return}TSMessenger.addReceiver(function(e,jsonData){if(jsonData&&jsonData.ts_event_type==="PARENT_RECEIVER_READY"){TSMessenger.removeReceiver("parentReceiverReceiver");TSPF.BuyButton.hasParentReceiver=true}},TSConfig.parentLocation.match(/^http.?:\/\/[^\/\s]+/)[0],"parentReceiverReceiver");TSMessenger.send({ts_action:"CHECK_PARENT_RECEIVER"},parent,TSConfig.parentLocation)}function createStoreOnClick(params){var onclick=function(e){if(TSPF.BuyButton.load(params)){TSCoreUtil.Event.preventDefault(e);return false}};return onclick}function initBuyButtons(parentElement){var artistId;var allAnchors=(parentElement||document).getElementsByTagName("a");for(var i=0;i<allAnchors.length;i++){var params=null;var anchor=allAnchors[i];if(anchor.href&&(anchor.href.indexOf(".topspin.net/store/")>=0||anchor.href.indexOf(".spinshop.com/")>=0)){params=TSCoreUtil.getQueryParams(anchor.href);if(params.aId&&params.cId&&new String(anchor.onclick).indexOf("TSPF.BuyButton.load")===-1){TSCoreUtil.DOM.addEventHandler(anchor,"click",createStoreOnClick(params))}else{params=null}}else{var onclickStr=new String(anchor.onclick);if(onclickStr.indexOf("TSPF.BuyButton.load")>=0){params=eval(onclickStr.substring(onclickStr.indexOf("TSPF.BuyButton.load")+"TSPF.BuyButton.load".length,onclickStr.length-1))}}if(params){TSTrackingEvent.logEvent(params);if(!artistId&&params.aId){artistId=params.aId}}}return artistId}function init(){if(!document.getElementById("topspin_style_addition")){TSCoreUtil.createStyleSheet("topspin_style_addition",TSConfig.CDN_URL+"stylesheets/widget.css");var artistId=initBuyButtons();if(!artistId){var scriptNodes=document.getElementsByTagName("script");for(var i=0;i<scriptNodes.length;i++){var url=scriptNodes[i].src;if(url.indexOf("topspin_purchase.js")>=0||url.indexOf("topspin_core.js")>=0){var urlParams=TSCoreUtil.getQueryParams(url);if(urlParams.aId){artistId=urlParams.aId}}}}if(self==top){if(artistId){TSCart.init(artistId)}createParentReceiver()}else{if(TSConfig.parentLocation){checkForParentReceiver()}}}}function loadPurchaseFlow(params){var isMobileSafari=navigator.userAgent.toLowerCase().match(/iphone|ipod|ipad|android|blackberry/i);if(isMobileSafari){var pfURL=TSConfig.STORE_URL+"purchase_flow/configure?campaign_id="+params.campaignId;if(TSPF.Cart.orderId){pfURL+="&order_id="+TSPF.Cart.orderId+"&token="+TSPF.Cart.token}pfURL+="&parent_url="+encodeURI(window.location.href);if(params.affiliate_id){pfURL+="&affiliate_id="+params.affiliate_id}window.open(pfURL,"ts_purchase");return true}if(self!=top){if(TSConfig.parentLocation&&TSPF.BuyButton.hasParentReceiver){TSMessenger.send({ts_action:"LOAD_PURCHASE_FLOW",pf_params:params},parent,TSConfig.parentLocation);return true}else{if(isTSURL(self.location.href)){return false}}}TSPF.LightBox.render();embedPurchaseFlow(params);return true}function embedPurchaseFlow(params){var artistId=params.artistId;var campaignId=params.campaignId;var action=params.action;var affiliateId=params.affiliate_id;var theme=TSPF.Config.theme||params.theme||"";var highlightColor=TSPF.Config.highlightColor||params.highlightColor||"";var iframeURL;if(action){iframeURL=TSConfig.STORE_URL+"purchase_flow/"+action+"?"}else{if(!campaignId){iframeURL=TSConfig.STORE_URL+"purchase_flow/cart?"}else{iframeURL=TSConfig.STORE_URL+"purchase_flow/configure?campaign_id="+campaignId+"&"}}iframeURL+="artist_id="+artistId+"&theme="+theme+"&highlight_color="+encodeURIComponent(highlightColor);if(TSPF.Cart.orderId){iframeURL+="&order_id="+TSPF.Cart.orderId+"&token="+TSPF.Cart.token}if(TSPF.Config.customStylesheetURL!==""){iframeURL+="&custom_stylesheet_url="+encodeURIComponent(TSPF.Config.customStylesheetURL)}iframeURL+="&parent_url="+encodeURI(window.location.href);if(affiliateId){iframeURL+="&affiliate_id="+affiliateId}if(false){}else{if(TSPF.queryParams.awesm){iframeURL+="&awesm="+TSPF.queryParams.awesm}}TSPF.LightBox.renderFrame(iframeURL)}return{initialize:init,initializeBuyButtons:initBuyButtons,load:function(params){return loadPurchaseFlow({artistId:params.aId,campaignId:params.cId,affiliate_id:params.affiliate_id,theme:params.theme,highlightColor:params.highlightColor,action:params.tspf_action})},embed:function(params){var src=TSCoreUtil.getQueryParams()["is_facebook"]?"tsfb":null;embedPurchaseFlow({artistId:params.aId,campaignId:params.cId,affiliate_id:params.affiliate_id,theme:params.theme,highlightColor:params.highlightColor,src:src})},embedPurchaseFlow:embedPurchaseFlow,loadPurchaseFlow:loadPurchaseFlow,createParentReceiver:createParentReceiver,checkForParentReceiver:checkForParentReceiver}}();TSPF.RedeemButton=function(){function a(f){var c=TSPF.LightBox.render(null,null,"CLOSE");var e=c.parentNode;TSPF.RedeemButton.embedRedemptionWidget(f,c.id);function d(){var j=e.getElementsByTagName("a");var h=false;for(var g=0;g<j.length;g++){if(j[g].className.indexOf("abp-obj")>=0){h=true}}if(h){for(var g=0;g<j.length;g++){if(h&&j[g].className.indexOf("abp-obj")==-1){j[g].style.left="0px";j[g].style.cssFloat="left";j[g].style.textAlign="left";j[g].parentNode.style.textAlign="left"}}}}setTimeout(d,100)}function b(d){var g=d.artistId;if(!g){return}var e=d.action;var m=d.affiliatId;var j=TSPF.Config.theme||d.theme||"";var l=TSPF.Config.highlightColor||d.highlightColor||"";var c=480;var k=570;var f=document.getElementById("ts_ol_pflow");var h=TSConfig.APP_URL+"redemption/"+g+"?";h+="artist_id="+g+"&theme="+j+"&highlight_color="+encodeURIComponent(l);h+="&parent_url="+encodeURI(window.location.href);if(m){h+="&affiliate_id="+m}TSPF.LightBox.renderFrame(h,f,k)}return{load:function(c){TSPF.RedeemButton.loadRedemptionWidget({artistId:c.aId,theme:c.theme,highlightColor:c.highlightColor,action:c.tspf_action})},loadRedemptionWidget:a,embedRedemptionWidget:b}}();TSPF.LightBox={isOpen:false,render:function(c,b,n,g){TSPF.LightBox.isOpen=true;c=c||1;n=n||"KEEP SHOPPING";g=g||"ts_download_form";TSPF.LightBox.showOverlay();var a=document.getElementById(c);if(a!=null){a.parentNode.removeChild(a)}a=document.createElement("div");a.id="ts_ol_pflow";a.className=g;var h=document.createElement("div");h.id="ts_pflow_control";var m=document.createElement("a");m.href="javascript:void(0);";var d=TSConfig.CDN_URL+"images/widgetSupport/purchFlow/close1.gif";m.innerHTML="<img src='"+d+"' border='0' alt='Close'/>";TSCoreUtil.DOM.addEventHandler(m,"click",TSPF.LightBox.close);h.appendChild(m);if(TSPF.Config.keepShoppingLink){var k=document.createElement("a");k.id="keep_shopping";k.href="javascript:void(0);";k.innerHTML=n;TSCoreUtil.DOM.addEventHandler(k,"click",TSPF.LightBox.close);h.appendChild(k)}var j=document.createElement("span");j.id="pf_alt_"+c;j.className="TSFlash_alt";j.style.display="none";j.style.position="absolute";j.style.fontSize="12px";j.style.fontFamily="Verdana, Arial, Helvetica";j.style.backgroundColor="transparent";j.style.width="100%";j.style.border="none";j.style.color="#ffffff";j.innerHTML="";a.appendChild(h);a.appendChild(j);var f;if(window.pageYOffset){f=window.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){f=document.documentElement.scrollTop}else{f=document.body.scrollTop}}a.style.top=40+parseInt(f)+"px";var l=document.body.clientWidth;if(!l&&document.documentElement&&document.documentElement.clientWidth){l=document.documentElement.clientWidth}a.style.left=l/2-240+"px";var e=document.getElementsByTagName("body")[0];e.insertBefore(a,e.firstChild.nextSibling);TSLightBoxResizeHandler=function(){TSPF.LightBox.centerPane("ts_ol_pflow",212);TSPF.LightBox.redimensionOverlay()};TSCoreUtil.DOM.addEventHandler(window,"resize",TSLightBoxResizeHandler);if(b){TSPF.LightBox.renderFrame(b,a)}TSMessenger.sendLocal({ts_event_type:"LIGHTBOX_OPEN"});return j},close:function(b){TSPF.LightBox.isOpen=false;var a=document.getElementById("ts_ol_pflow");TSCoreUtil.DOM.removeEventHandler(window,"resize",TSLightBoxResizeHandler);TSLightBoxResizeHandler=null;TSPF.LightBox.hideOverlay();a.style.display="none";TSMessenger.removeReceiver("closeLightBoxReceiver");TSMessenger.sendLocal({ts_event_type:"LIGHTBOX_CLOSE"})},renderFrame:function(b,c){c=c||document.getElementById("ts_ol_pflow");var d="570";if(arguments.length>2){d=arguments[2]}var a=document.createElement("iframe");a.id="ts_pflow_frame";a.name="ts_pflow_frame";a.style.display="none";a.style.width="480px";a.style.height=d+"px";a.style.background="#000";a.style.borderWidth="0";a.frameBorder="0";TSCoreUtil.DOM.addEventHandler(a,"load",TSPF.LightBox.showFrame);a=c.appendChild(a);try{if(TSPF.Config.ts_artist_gat){_gaq.push(["_setDomainName","none"]);_gaq.push(["_setAllowLinker",true]);_gaq.push(function(){var f=_gat._getTrackerByName("ts_artist");a.src=f._getLinkerUrl(b)})}else{a.src=b}}catch(e){}TSMessenger.addReceiver(function(g,f){if(f&&f.ts_action=="CLOSE_LIGHT_BOX"){TSMessenger.removeReceiver("closeLightBoxReceiver");TSPF.LightBox.close()}},b.match(/^http.?:\/\/[^\/\s]+/)[0],"closeLightBoxReceiver")},showFrame:function(){var a=document.getElementById("ts_pflow_frame");a.style.display=""},getOverlayDimensions:function(){var d;var h;if(window.innerWidth){d=window.innerWidth;h=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientWidth){d=document.documentElement.clientWidth;h=document.documentElement.clientHeight}else{d=document.body.clientWidth;h=document.body.clientHeight}}var a;var f;if(window.innerHeight&&window.scrollMaxY){a=window.innerWidth+window.scrollMaxX;f=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){a=document.body.scrollWidth;f=document.body.scrollHeight}else{a=document.body.offsetWidth;f=document.body.offsetHeight}}var b=(d>a)?d:a;var g=(h>f)?h:f;function c(){var k=document.getElementsByTagName("*");var j=0;function l(q){var u=q.style.display;if(u!="none"&&u!=null){return{width:q.offsetWidth,height:q.offsetHeight}}var p=q.style;var t=p.visibility;var r=p.position;var o=p.display;p.visibility="hidden";p.position="absolute";p.display="block";var v=q.clientWidth;var s=q.clientHeight;p.display=o;p.position=r;p.visibility=t;return{width:v,height:s}}for(var m=0;m<k.length;m++){var n=l(k[m]).height;if(n>j){j=n}}return j}if(f==0||f==h){g=c()}var e={width:b,height:g};return e},redimensionOverlay:function(){var a=document.getElementById("TSOverlayBGDiv");var b=TSPF.LightBox.getOverlayDimensions();a.style.height=b.height+"px";a.style.width=b.width+"px"},showOverlay:function(){TSPF.LightBox.hideFlash();var b=document.getElementById("TSOverlayBGDiv");if(!b){b=document.createElement("div");b.id="TSOverlayBGDiv";b.innerHTML="&nbsp;";var a=document.getElementsByTagName("body")[0];a.appendChild(b,a)}TSPF.LightBox.redimensionOverlay();b.style.display="block"},hideOverlay:function(){var a=document.getElementById("TSOverlayBGDiv");if(a){a.style.display="none"}TSPF.LightBox.showFlash()},showFlash:function(){var b=document.getElementsByTagName("object");for(var a=0;a<b.length;a++){b[a].parentNode.style.textIndent="0px";if(b[a].style.visibility=="hidden"){b[a].style.visibility="visible"}}},hideFlash:function(){var e=document.getElementsByTagName("object");for(var d=0;d<e.length;d++){var f=e[d];var b=f.style.visibility!="hidden"&&f.id!="pf_alt_1";if(b){var c=f.getElementsByTagName("param");if(c&&c.length>0){for(var a=0;a<c.length;a++){if(c[a].getAttribute("name").toUpperCase()=="WMODE"){if(c[a].getAttribute("value").toUpperCase()!="WINDOW"){b=false}break}}}}if(b){f.style.visibility="hidden";f.parentNode.style.textIndent="-9999px"}}},centerPane:function(a,d){var b=document.getElementById(a);var c=(parseInt(document.body.clientWidth))/2-d+"px";b.style.left=c},paneScroll:function(a,f){var d=document.getElementById(a);var b=new String(navigator.userAgent);var c;if(b.indexOf("MSIE")>-1){c=parseInt(document.documentElement.scrollTop)}else{c=parseInt(window.pageYOffset)}var e=f+c+"px";d.style.top=e}};TSPF.Helper=function(){function b(){var c=setTimeout("TSPF.Helper.launchPF()",500)}function a(){var c=TSCoreUtil.getQueryParams();if(c.aId){if(c.pf&&c.pf=="redeem"){TSPF.RedeemButton.load(c)}else{if(c.cId||(c.pf&&c.pf=="buy")){TSPF.BuyButton.load(c)}}return}if(c.aId&&c.tspf_action){if(!c.pf||c.pf!="redeem"){TSPF.BuyButton.load(c)}return}}return{initialize:b,launchPF:a}}();TSPF.Cart=function(){var d=0;function c(){return document.body}function b(o){o=o||{};var m=document.getElementById("TSCart_swf_div");if(!m){var l=document.createElement("div");document.body.appendChild(l);m=document.createElement("div");m.id="TSCart_swf_div";l.id="TSCart_swf_div_wrap";l.style.height="0";l.style.position="absolute";l.style.left="-9999px";l.appendChild(m)}var n=1;var h=1;var j=TSConfig.STORE_URL+"widgets/purchase/TSShopProxy.swf";var k={facing:"fan",variables:{baseUrl:TSConfig.STORE_URL.replace(/\/$/,""),artistId:o.artistId||this.artistId,orderId:o.orderId,token:o.token},params:{quality:"high",allowscriptaccess:"always",allowfullscreen:"true",movie:j},width:n,height:h,instance:m.id};TSFlash.embed(j,m.id,k)}function a(){if(f()){g()}else{var h=c();for(var k in h.childNodes){if(h.childNodes[k].nodeType==1){var l=h.childNodes[k];break}}var j=document.createElement("div");j.id="TSCart_header_wrap";j.style.display="none";h.insertBefore(j,l);j.innerHTML=e()}}function g(){var h=c();var k=h.innerHTML;var j=document.createElement("div");j.id="TSCart_IE6_wrap";h.innerHTML=null;h.innerHTML="\n";h.parentElement.style.height="100%";h.parentElement.style.overflow="hidden";h.style.height="100%";h.style.overflow="hidden";h.appendChild(j);k='<div id="TSCart_header_wrap" style="display:none;">'+e()+"</div>"+k;j.innerHTML=k}function f(){return window.XMLHttpRequest?false:true}function e(){return'<div id="TSCart_header_container"><div id="TSCart_header"><a href="javascript:TSCart.loadPurchaseFlow();">Cart (<span id="TSCart_num_items">0</span>) <img src="'+TSConfig.CDN_URL+'images/widgetSupport/purchFlow/cart.png" style="border:none;" /></a></div></div>'}return{init:function(h){this.artistId=h;this.orderId="";this.token="";b({artistId:h,orderId:"",token:""});TSCoreUtil.createStyleSheet("TSCart_css",TSConfig.CDN_URL+"stylesheets/TSCart.css");a();TOPSPIN.addListener(TSCart.hide,"LIGHTBOX_OPEN");TOPSPIN.addListener(function(j){TSCart.hide();TSCart.reloadCallbackSWF()},"LIGHTBOX_CLOSE")},isReady:function(){return this.artistId?true:false},hide:function(){var h=document.getElementById("TSCart_header_wrap");h.style.display="none"},show:function(){if(TSPF.LightBox.isOpen){return}var h=document.getElementById("TSCart_header_wrap");h.style.display="block"},setItemCount:function(h){d=h||0;this.update()},getItemCount:function(){return d},update:function(j){this.orderId=j.order_id||"";this.token=j.token||"";d=j.item_count||0;var h=document.getElementById("TSCart_num_items");if(h){h.innerHTML=d}if(d<=0){if(this.showWhenEmpty){this.show();this.disableCartLink()}else{this.hide()}}else{if(this.showWhenEmpty){this.show();this.enableCartLink(d)}else{this.show()}}if(this.orderId){TSMessenger.sendLocal({ts_event_type:"CART_UPDATE",order_id:this.orderId,item_count:d})}},disableCartLink:function(){var j=document.getElementById("TSCart_header");var h='Your cart is empty. Please select an item.&nbsp;<p><img src="'+TSConfig.CDN_URL+'images/widgetSupport/purchFlow/cart.png" style="border:none;" /></p></div>';j.innerHTML=h},enableCartLink:function(k){var j=document.getElementById("TSCart_header");var h='<a href="javascript:TSPF.Cart.loadPurchaseFlow();">Cart (<span id="TSCart_num_items">'+k+'</span>) <img src="'+TSConfig.CDN_URL+'images/widgetSupport/purchFlow/cart.png" style="border:none;" /></a>';j.innerHTML=h},loadPurchaseFlow:function(){TSPF.BuyButton.loadPurchaseFlow({artistId:this.artistId})},reloadCallbackSWF:function(h){h=h||{artistId:this.artistId,orderId:this.orderId,token:this.token};b(h)},showWhenEmpty:false,addToCart:function(j){j.auto_add=true;j.artist_id=j.artist_id||this.artistId;if(this.orderId){j.order_id=this.orderId;j.token=this.token}var h=this;new TSJSONP.Request({url:TSConfig.STORE_URL+"purchase_flow/configure",params:j,onSuccess:function(k){var l={artistId:h.artistId=k.artist_id,orderId:h.orderId=k.order_id,token:h.token=k.token};h.reloadCallbackSWF(l)}});return false}}}();if(window.location.href.indexOf("/store/facebook_iframe_purchase/")<0){TSCoreUtil.DOM.addEventHandler(window,"load",TSPF.Helper.initialize);TSCoreUtil.DOM.addEventHandler(window,"load",TSPF.BuyButton.initialize);if(!TSPF.Config.ts_artist_gat){var scriptNodes=document.getElementsByTagName("script");for(var i=0;i<scriptNodes.length;i++){var url=scriptNodes[i].src;if(url.indexOf("topspin_purchase.js")>=0||url.indexOf("topspin_core.js")>=0){var gat=TSCoreUtil.getQueryParams(url)["gat"];if(gat){TSPF.Config.ts_artist_gat=gat;break}}}}if(TSPF.Config.ts_artist_gat){var _gaq=_gaq||[];_gaq.push(["ts_artist._setAccount",TSPF.Config.ts_artist_gat])}(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})()}var TSPurchase=TSPF.BuyButton;var TSCart=TSPF.Cart}if(typeof Prototype!=="undefined"&&typeof JSON==="undefined"){JSON={stringify:function(a){return Object.toJSON(a)},parse:function(a){return String(a).evalJSON()}}}else{if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\""',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}())}var TSMessenger=function(){var m=typeof window.postMessage!="undefined";var q;var f=[];var j=0;var p=200;var a="tsm_";var c=/^#(tsm_\d+)=/;var r;function g(v,x,s){if(!v||!x||!s){return}try{v=JSON.stringify(v)}catch(w){}if(m){var t=s.match(/^http.?:\/\/[^\/\s]+/)[0];x.postMessage(v,t)}else{if(s.indexOf("#")!=-1){s=s.substring(0,s.indexOf("#"))}var u=a+new Date().getTime();x.location=s+"#"+u+"="+encodeURIComponent(v)}}function k(s){var t={data:JSON.stringify(s)};l(t,true)}function o(u,s,t){if(!t||!b(t)){t=t||"receiver_"+j++;f.push({id:t,callback:u,acceptedOrigin:s});d()}return t}function e(v){var s=[];for(var t=0;t<f.length;t++){if(f[t].id!==v){s.push(f[t])}}var u=s.length<f.length;if(u){f=s}return u}function b(t){for(var s=0;s<f.length;s++){if(f[s].id===t){return true}}return false}function h(){n();f=[]}function d(){if(q){return}if(m){q=l;if(typeof window.addEventListener!="undefined"){window.addEventListener("message",q,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onmessage",q)}}}else{document.location.hash="";q=setInterval(function(){var t=document.location.hash;if(!t){return}var s=t.match(c);if(s&&s[1]!=r){r=s[1]}else{return}l({data:t.substring(t.indexOf("=")+1)})},p)}}function n(){if(!q){return}if(m){if(typeof window.removeEventListener!="undefined"){window.removeEventListener("message",q,false)}else{if(typeof window.detachEvent!="undefined"){window.detachEvent("onmessage",q)}}}else{clearInterval(q)}q=null}function l(x,v){if(f.length){var s=f.slice(0);for(var u=0;u<s.length;u++){var y=s[u];if(!v&&m){var t=y.acceptedOrigin;if(!t||x.origin.toLowerCase()!==t.toLowerCase()){continue}}var w=null;try{w=JSON.parse(decodeURIComponent(x.data))}catch(z){}y.callback(x,w)}delete s}}return{send:g,sendLocal:k,addReceiver:o,removeReceiver:e,hasReceiver:b,clearReceivers:h,startReceiving:d,stopReceiving:n}}();var TSJSONP=(function(){var d=0;var c=document.getElementsByTagName("head")[0];function b(g){var h="TSJSONPResponse_"+d++;var e=g.url+(g.url.indexOf("?")==-1?"?":"&");if(g.params){g.params.callback=h;e+="json="+encodeURIComponent(JSON.stringify(g.params))}else{e+="callback="+h}window[h]=function(j){c.removeChild(document.getElementById(h));window[h]=undefined;if(g.onSuccess){g.onSuccess(j)}};var f=document.createElement("script");f.type="text/javascript";f.src=e;f.id=h;c.appendChild(f)}function a(e){if(!e||!e.url){return}this.url=e.url;this.params=e.params;this.onSuccess=e.onSuccess;b(this)}return{Request:a}})();var TSSSO=(function(){function a(f,g,h,d){var c="";if(f.products){c+=c==""?"?":"&";c+="products="+f.products}if(f.campaigns){c+=c==""?"?":"&";c+="campaigns="+f.campaigns}if(f.artist_id){c+=c==""?"?":"&";c+="artist_id="+f.artist_id}g=g||encodeURI(window.location.href);var e=TSConfig.APP_URL+"auth/gate"+c+"&parent_url="+g;TSPF.LightBox.render(undefined,e,"CANCEL",undefined,h,d)}function b(e,f){var c="";if(e.products){c+=c==""?"?":"&";c+="products="+e.products.join(",")}if(e.campaigns){c+=c==""?"?":"&";c+="campaigns="+e.campaigns.join(",")}if(e.artist_id){c+=c==""?"?":"&";c+="artist_id="+e.artist_id}if(e.reset){c+=c==""?"?":"&";c+="reset="+e.reset}var d=TSConfig.APP_URL+"api/v1/access/authorized"+c;new TSJSONP.Request({url:d,onSuccess:function(g){e.response=g;f(e)}})}return({showLogin:a,checkAccess:b})})();if(!window.TSW){var TSW={};function initWidget(){var c=navigator.userAgent.match(/iPhone|iPod|iPad/i);if(c){var p=document.getElementsByClassName("topspin-widget-email-for-media");for(var g=0;g<p.length;g++){var o=p[g].innerHTML;var e=o.match(/width="([0-9]+)"/);var d=o.match(/height="([0-9]+)"/);var q=e[1];var l=d[1];var b=o.match(/(email_for_media)\/(\d+)/);var r=(b&&b.length>1)?b[2]:null;var f="";var m=p[g].getElementsByTagName("param");if(m&&m.length>0){for(var k=0;k<m.length;k++){if(m[k].attributes.name.value.toUpperCase()=="FLASHVARS"){var o=m[k].attributes.value.value;f=getQS(o);if(!r){paramHash=TSCoreUtil.getQueryParams(o);if(paramHash&&paramHash.wId){r=paramHash.wId}}break}}}var a=TSConfig.APP_URL+"w/"+r+"?w="+q+"&h="+l+"&m=1";a+=(f!=="")?"&"+f:"";if(r){var n="<iframe src='"+a+"' frameborder='0' border='0' cellspacing='0' style='padding: 0px; border-style: none;width: "+q+"px; height: "+l+"px;'></iframe>";p[g].innerHTML=n}}}}function getQS(c){var b=c;b=b.replace(/^\s+/,"").replace(/\s+$/,"");var a=b.match(/([^?#]*)(#.*)?$/);if(!a){return{}}else{return a[0]}}TSCoreUtil.DOM.addEventHandler(window,"load",initWidget)}var TOPSPIN=function(){var d={PURCHASE_COMPLETE:"tbd",CART_UPDATE:"tbd",LIGHTBOX_OPEN:"tbd",LIGHTBOX_CLOSE:"tbd"};var a=TSConfig.STORE_URL.replace(/\/$/,"");var c=[];function b(g,j,f){if(!d[g]){if(d[j]){var h=g;g=j;j=h}else{return false}}f=f||a;c.push(TSMessenger.addReceiver(function(m,k){if(k&&k.ts_event_type&&k.ts_event_type==g){try{j(k)}catch(l){}}},f));return true}var e=function(){function f(h,g){g=g||"PURCHASE_COMPLETE";TOPSPIN.addListener(h,g,a)}return{addListener:f}}();return{addListener:b,addToCart:function(f){TSPF.Cart.addToCart(f)},PurchaseFlow:e}}();